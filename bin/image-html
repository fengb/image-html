#!/usr/bin/env node


var fs = require('fs');
var ImageHtml = require('..');
var Image = require('canvas-browserify').Image;



var opts = function(args){
  var opts = {name: args[0], args: []};
  for(var i=1; i < args.length; i++){
    if(args[i][0] == '-'){
      switch(args[i]) {
        case '-f': case '--format':
          opts.format = args[++i];
          break;
        default:
          throw ('Unknown switch: ' + args[i]);
      }
    } else{
      opts.args.push(args[i]);
    }
  }
  return opts;
}(process.argv);


var data = fs.readFileSync(opts.args[1]);


var img = new Image();
img.src = data;
var output = ImageHtml.convert(img, 'a', opts.format);
var html = ['<!DOCTYPE html>',
            '<html>',
            '<head>',
            '<title>'+opts.args[1]+'</title>',
            '<style>',
            output.css(),
            '</style>',
            '</head>',
            '<body style="margin:0">',
            output.html(),
            '<script>',
            output.js(),
            '</script>',
            '</body>',
            '</html>'].join('\n');

if(opts.args[2]){
  fs.writeFile(opts.args[2], html, function(err){
    if(err) throw err;
  });
} else {
  console.log(html);
}
